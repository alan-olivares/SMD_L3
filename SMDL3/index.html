<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        Datos
    </title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
</head>

<body>

    <div id="wrapper">

        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav metismenu" id="side-menu">
                    <li class="nav-header">
                        <div class="dropdown profile-element">
                            <img alt="image" src="../img/bat.png" />
                        </div>
                        <div class="logo-element">
                            FTEM
                        </div>
                    </li>
                    <li class="active"><a href="index.html"><i class="fa fa-table"></i> <span class="nav-label">Graficas</span></a></li>
                    <li>
                        <a href="..\GDXL\index.aspx"><i class="fa fa-industry"></i> <span class="nav-label">GD XL</span> <span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a href="..\GDXL\index.aspx"><i class="fa fa-table"></i> <span class="nav-label">Datos</span></a></li>
                            <li><a href="..\GDXL\bd.aspx?Id=1"><i class="fa fa-area-chart"></i> <span class="nav-label">Indicadores</span></a></li>
                            <li><a href="..\GDXL\dds.aspx?Id=1"><i class="fa fa-tachometer"></i> <span class="nav-label">DDS</span></a></li>
                            <li><a href="..\GDXL\carga.aspx"><i class="fa fa-upload"></i> <span class="nav-label">Carga Manual</span></a></li>
                            <li><a href="..\GDXL\targets.html"><i class="fa fa-bullseye"></i> <span class="nav-label">Targets</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-industry"></i> <span class="nav-label">GD</span><span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a href="..\GD\index.aspx"><i class="fa fa-table"></i> <span class="nav-label">Datos</span></a></li>
                            <li><a href="..\GD\bd.aspx?Id=1"><i class="fa fa-area-chart"></i> <span class="nav-label">Indicadores</span></a></li>
                            <li><a href="..\GD\dds.aspx?Id=1"><i class="fa fa-tachometer"></i> <span class="nav-label">DDS</span></a></li>
                            <li><a href="..\GD\carga.aspx"><i class="fa fa-upload"></i> <span class="nav-label">Carga Manual</span></a></li>
                            <li><a href="..\GD\targets.html"><i class="fa fa-bullseye"></i> <span class="nav-label">Targets</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-industry"></i> <span class="nav-label">FOCKE</span><span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a href="..\FOCKE\index.aspx"><i class="fa fa-table"></i> <span class="nav-label">Datos</span></a></li>
                            <li><a href="..\FOCKE\bd.aspx?Id=1"><i class="fa fa-area-chart"></i> <span class="nav-label">Indicadores</span></a></li>
                            <li><a href="..\FOCKE\dds.aspx?Id=1"><i class="fa fa-tachometer"></i> <span class="nav-label">DDS</span></a></li>
                            <li><a href="..\FOCKE\carga.aspx"><i class="fa fa-upload"></i> <span class="nav-label">Carga Manual</span></a></li>
                            <li><a href="..\FOCKE\targets.html"><i class="fa fa-bullseye"></i> <span class="nav-label">Targets</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-industry"></i> <span class="nav-label">BEVEL</span><span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li><a href="..\BEVEL\index.aspx"><i class="fa fa-table"></i> <span class="nav-label">Datos</span></a></li>
                            <li><a href="..\BEVEL\bd.aspx?Id=1"><i class="fa fa-area-chart"></i> <span class="nav-label">Indicadores</span></a></li>
                            <li><a href="..\BEVEL\dds.aspx?Id=1"><i class="fa fa-tachometer"></i> <span class="nav-label">DDS</span></a></li>
                            <li><a href="..\BEVEL\carga.aspx"><i class="fa fa-upload"></i> <span class="nav-label">Carga Manual</span></a></li>
                            <li><a href="..\BEVEL\targets.html"><i class="fa fa-bullseye"></i> <span class="nav-label">Targets</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-industry"></i> <span class="nav-label">SLIDE & SHELL</span><span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a href="..\SLIDESHELL\index.aspx"><i class="fa fa-table"></i> <span class="nav-label">Datos</span></a></li>
                            <li><a href="..\SLIDESHELL\bd.aspx?Id=1"><i class="fa fa-area-chart"></i> <span class="nav-label">Indicadores</span></a></li>
                            <li><a href="..\SLIDESHELL\dds.aspx?Id=1"><i class="fa fa-tachometer"></i> <span class="nav-label">DDS</span></a></li>
                            <li><a href="..\SLIDESHELL\carga.aspx"><i class="fa fa-upload"></i> <span class="nav-label">Carga Manual</span></a></li>
                            <li><a href="..\SLIDESHELL\targets.html"><i class="fa fa-bullseye"></i> <span class="nav-label">Targets</span></a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-industry"></i> <span class="nav-label">SIDE PACK</span><span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level collapse">
                            <li><a href="..\SIDEPACK\index.aspx"><i class="fa fa-table"></i> <span class="nav-label">Datos</span></a></li>
                            <li><a href="..\SIDEPACK\bd.aspx?Id=1"><i class="fa fa-area-chart"></i> <span class="nav-label">Indicadores</span></a></li>
                            <li><a href="..\SIDEPACK\dds.aspx?Id=1"><i class="fa fa-tachometer"></i> <span class="nav-label">DDS</span></a></li>
                            <li><a href="..\SIDEPACK\carga.aspx"><i class="fa fa-upload"></i> <span class="nav-label">Carga Manual</span></a></li>
                            <li><a href="..\SIDEPACK\targets.html"><i class="fa fa-bullseye"></i> <span class="nav-label">Targets</span></a></li>
                        </ul>
                    </li>

                </ul>

            </div>
        </nav>


        <div id="page-wrapper" class="gray-bg">

            <div class="page-content">
                <div class="wrapper wrapper-content animated fadeInRight">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="ibox " id="ibox1">
                                <div class="ibox-title">
                                    <h5>Enercon Dashboard 3.0 - Graficas por Área</h5>
                                </div>
                                <div class="ibox-content">
                                    <div class="sk-spinner sk-spinner-double-bounce">
                                        <div class="sk-double-bounce1"></div>
                                        <div class="sk-double-bounce2"></div>
                                    </div>
                                    <div class="col-md-12 d-flex justify-content-center">
                                        <div class="text-center col-md-4">
                                            <h5 style="margin-right:20px;">
                                                <label class="">Fecha:</label>
                                                <input type="week" class="form-control b-r-xl" id="date1" onchange="ObtenerJson()" onkeydown="return false">
                                            </h5>
                                        </div>
                                        <div class="text-center col-md-4">
                                            <h5 style="margin-right:20px;">
                                                <label class="">Area:</label>
                                                <select class="form-control b-r-xl" onchange="ObtenerJson();" id="areas">
                                                </select>
                                            </h5>
                                        </div>
                                    </div>
                                    <div class="col-md-12 row justify-content-center sk-loading" id="graficas" style="margin-top:10px;margin-bottom:150px;">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="float-right">
                    <strong>British American Tobacco México</strong>
                </div>
            </div>
        </div>
    </div>



    <!-- Mainly scripts -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <script src="js/plugins/dataTables/datatables.min.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>
    <!-- Flot -->
    <script src="js/plugins/flot/jquery.flot.js"></script>
    <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="js/plugins/flot/jquery.flot.time.js"></script>
    <script src="js/plugins/flot/jquery.flot.categories.min.js"></script>
    <script src="js/plugins/flot/jquery.flot.axislabels.js"></script>
    <script src="js/funciones_generales.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script>
        !function (a) { "use strict"; function e(e) { e.hooks.draw.push(function (e, t) { var l, s, o, i, r, n, d, f, u, b, h, v, x, g, c, L, w, p, m, M, y, z, O, C = {}, P = "left"; a.each(e.getData(), function (a, B) { if (B.valueLabels.show || B.stack) { var k = B.valueLabels.showLastValue, A = B.valueLabels.showMaxValue, S = B.valueLabels.showMinValue, F = B.valueLabels.showTextLabel, V = B.valueLabels.labelFormatter, Z = B.valueLabels.xoffset, T = B.valueLabels.yoffset, I = B.valueLabels.xoffsetMin || Z, D = B.valueLabels.yoffsetMin || T, R = B.valueLabels.xoffsetMax || Z, X = B.valueLabels.yoffsetMax || T, Y = B.valueLabels.xoffsetLast || Z, j = B.valueLabels.yoffsetLast || T, Q = B.valueLabels.valign, W = B.valueLabels.valignLast || Q, q = B.valueLabels.valignMin, E = B.valueLabels.valignMax, G = B.valueLabels.align, H = B.valueLabels.rotate || 0, J = B.valueLabels.horizAlign, K = B.valueLabels.horizAlignMin || J, N = B.valueLabels.horizAlignMax || J, U = B.valueLabels.horizAlignLast || J, $ = B.valueLabels.fontcolor || "#222222", _ = B.valueLabels.shadowColor, aa = B.valueLabels.font || B.xaxis.font || "9pt san-serif", ea = B.valueLabels.hideZero, ta = B.valueLabels.hideSame, la = B.valueLabels.reverseAlignBelowZero, sa = B.valueLabels.showShadow, oa = B.valueLabels.useDecimalComma, ia = B.stack, ra = B.valueLabels.decimals, na = B.valueLabels.useBackground, da = B.valueLabels.backgroundColor, fa = B.valueLabels.useBorder, ua = B.valueLabels.borderColor, ba = B.bars.order || 0; B.seriesIndex = a; var ha = null, va = -1e3, xa = -1e3, ga = "categories" == B.xaxis.options.mode, ca = "categories" == B.yaxis.options.mode; if (O = B.points.show ? B.points.radius - B.points.lineWidth / 2 : 0, (S || A) && "undefined" != typeof B.data[0]) { B.data[0][0] = +B.data[0][0], B.data[0][1] = +B.data[0][1]; for (var La = +B.data[0][0], wa = +B.data[0][0], pa = +B.data[0][1], ma = +B.data[0][1], Ma = 1; Ma < B.data.length; ++Ma)B.data[Ma][0] = +B.data[Ma][0], B.data[Ma][1] = +B.data[Ma][1], +B.data[Ma][0] < La && (La = +B.data[Ma][0]), +B.data[Ma][0] > wa && (wa = +B.data[Ma][0]), +B.data[Ma][1] < pa && (pa = +B.data[Ma][1]), +B.data[Ma][1] > ma && (ma = +B.data[Ma][1]) } else { S = !1, A = !1; for (var Ma = 0; Ma < B.data.length; ++Ma)B.data[Ma][0] = +B.data[Ma][0], B.data[Ma][1] = +B.data[Ma][1] } g = S || A || k; for (var Ma = 0; Ma < B.data.length; ++Ma)if (null !== B.data[Ma]) { if (s = B.data[Ma][0], d = B.data[Ma][1], l = F && B.data[Ma].length > 2 ? B.data[Ma][2] : !1, g) { if (c = !1, S && pa == d && !B.bars.horizontal ? (c = !0, n = I, h = D, v = q, S = !1) : S && La == s && B.bars.horizontal ? (c = !0, n = I, h = D, x = K, S = !1) : A && ma == d && !B.bars.horizontal ? (c = !0, n = R, h = X, v = E, A = !1) : A && wa == s && B.bars.horizontal ? (c = !0, n = R, h = X, x = N, A = !1) : k && Ma == B.data.length - 1 && !B.bars.horizontal ? (c = !0, n = Y, h = j, v = W) : k && Ma == B.data.length - 1 && B.bars.horizontal && (c = !0, n = Y, h = j, x = U), !c) continue } else la && 0 > d && !B.bars.horizontal ? (n = Z, h = -1 * T, "above" == Q ? Q = "below" : "below" == Q && (Q = "above"), v = Q) : (n = Z, h = T, v = Q, x = J); if ("top" == v && (v = "above"), ga && (s = B.xaxis.categories[s]), ca && (d = B.yaxis.categories[d]), !(s < B.xaxis.min || s > B.xaxis.max || d < B.yaxis.min || d > B.yaxis.max)) { if (l !== !1) L = l; else { if (L = B.bars.horizontal ? s : d, null == L && (L = ""), 0 === L && (ea || ia)) continue; ra !== !1 && (L = parseFloat(L).toFixed(ra)) } if (B.valueLabels.valueLabelFunc && (L = B.valueLabels.valueLabelFunc({ series: B, seriesIndex: a, index: Ma })), L = "" + L, L = V(L, { series: B, point: B.data[Ma] }), !ta || L != ha || Ma == B.data.length - 1) { if (B.bars.horizontal && (t.font = aa, y = fa || na ? 10 : 6, Math.abs(B.xaxis.p2c(s) - B.xaxis.p2c(0)) < t.measureText(L).width + Math.abs(n) + y && "outside" != x && (n = -1 * n, x = "outside")), oa && (L = L.toString().replace(".", ",")), w = 0, ia) { var ya = s + "-" + ba; if (C[ya] || (C[ya] = 0), w = C[ya], C[ya] = C[ya] + d, !B.valueLabels.show) continue } o = B.xaxis.p2c(s) + e.getPlotOffset().left, f = B.yaxis.p2c(d + w) + e.getPlotOffset().top, (!ta || Math.abs(f - xa) > 20 || o > va) && (ha = L, va = o + 8 * L.length, xa = f, B.bars.horizontal ? (b = f, z = "middle", s >= 0 ? "outside" == x ? (P = "left", n += 4) : "insideMax" == x ? (P = "right", n -= 4) : "insideCenter" == x ? (P = "center", o = e.getPlotOffset().left + B.xaxis.p2c(0) + (B.xaxis.p2c(s) - B.xaxis.p2c(0)) / 2 + n) : "insideZero" == x && (P = "left", o = e.getPlotOffset().left + B.xaxis.p2c(0) + 3 + n) : "outside" == x ? (P = "right", n -= 4) : "insideMax" == x ? (P = "left", n += 4) : "insideCenter" == x ? (P = "center", o = e.getPlotOffset().left + B.xaxis.p2c(0) + (B.xaxis.p2c(s) - B.xaxis.p2c(0)) / 2 + n) : "insideZero" == x && (P = "right", o = e.getPlotOffset().left + B.xaxis.p2c(0) - 4 + n), r = o + n) : ("bottom" == v ? (z = "bottom", f = e.getPlotOffset().top + e.height()) : "middle" == v ? (z = "middle", M = e.getPlotOffset().top + e.height(), f = (M + f) / 2) : "below" == v ? (z = "top", h = h + 4 + O) : "above" == v && (z = "bottom", h = h - 2 - O), r = o + n, b = f + h, 0 >= f && (b += 16), o >= e.width() + e.getPlotOffset().left ? (r = e.width() + e.getPlotOffset().left + n - 3, P = "right") : P = G), t.font = aa, (fa || na) && (m = t.measureText(L).width + 5, m % 2 == 1 && m++, p = parseInt(aa, 10) + 7, "top" == z ? (u = b, b += 3) : "bottom" == z ? (u = b - p - 2, b -= 2) : "middle" == z && (u = b - (p + 1) / 2, b += 1), "right" == P ? (i = r - m + 1, r -= 2) : "left" == P ? (i = r, r += 3) : i = r - m / 2, t.shadowOffsetX = 0, t.shadowOffsetY = 0, t.shadowBlur = 0, fa && (t.strokeStyle = ua, t.strokeRect(i, u, m, p)), na && (t.fillStyle = da, t.fillRect(i, u, m, p))), t.fillStyle = $, t.save(), sa ? (t.shadowOffsetX = 0, t.shadowOffsetY = 0, t.shadowBlur = 1.5, t.shadowColor = _) : t.shadowBlur = 0, t.translate(r, b), 0 != H && t.rotate(H * Math.PI / 180), t.textAlign = P, t.textBaseline = z, t.fillText(L, 0, 0), t.restore()) } } } } }) }) } var t = { series: { valueLabels: { show: !1, showTextLabel: !1, showMaxValue: !1, showMinValue: !1, showLastValue: !1, labelFormatter: function (a) { return a }, align: "center", valign: "above", valignMin: "below", valignMax: "above", horizAlign: "insideMax", xoffset: 0, yoffset: 0, rotate: 0, useDecimalComma: !1, decimals: !1, hideZero: !1, hideSame: !1, reverseAlignBelowZero: !1, showShadow: !1, shadowColor: !1, useBackground: !1, backgroundColor: "#cccccc", fontcolor: "#222222", useBorder: !1, borderColor: "#999999" } } }; a.plot.plugins.push({ init: e, options: t, name: "valueLabels", version: "2.2.0" }) }(jQuery);

        //const getApi = "api/datos/";

        async function CargarAreas() {
            try {
                $('#ibox1').children('.ibox-content').toggleClass('sk-loading');
                var url = getApi + 'areas/';
                var result = await conexion("GET", url, "");
                var parsed = JSON.parse(result);
                llenarSelect('#areas', 'AreaId', 'Nombre', parsed);
                //$("#areas").val("13").change();
                ObtenerJson();
            } catch (e) {
                alert(e);
            } finally {
                $('#ibox1').children('.ibox-content').toggleClass('sk-loading');
            }

        }
        async function ObtenerJson() {
            try {
                $('#ibox1').children('.ibox-content').toggleClass('sk-loading');
                $('#graficas').empty();
                var url = getApi + '?fecha=' + $('#date1').val() + '&area=' + $('#areas').val();
                var result = await conexion("GET", url, "");
                var parsed = JSON.parse(result);
                crearGraficas(parsed);
            } catch (e) {
                alert(e);
            } finally {
                $('#ibox1').children('.ibox-content').toggleClass('sk-loading');
            }
        }
        function crearGraficas(json) {
            var dias = getDiasJson(json);
            for (var x = 0; x < json.length; x++) {
                $('#graficas').append('<div class="flot-chart col-md-12 text-center " style="margin-top:40px; margin-bottom:10px;"><h3 class= "col-md-12" id = "msTitulo' + x + '" >' + json[x].Indicador + '</h3 >' +
                    '<div class="flot-chart-content col-md-12" id="msGrafica' + x + '"></div>' +
                    '<div class="col-md-2" id="msLegend' + x + '" style="float: right;"></div></div>');
                cargarGraficaDatos(json[x], x, dias);
            }
        }
        function getDiasJson(json) {
            var dias = []
            if (json.length > 0) {
                var keys = Object.keys(json[0]);
                keys.forEach(function (key) {
                    if (key.includes('/'))
                        dias.push(key);
                });
            }
            return dias;

        }
        function cargarGraficaDatos(datos, indice, dias) {
            var limite = datos.Maximo == null ? 999999 : datos.Maximo
            var data = [];
            var ticks = [];
            for (var x = 0; x < dias.length; x++) {
                data.push({
                    data: [[x, datos[dias[x]]]], color: datos[dias[x]] > limite ? 'red' : '#6FB2ED', valueLabels: {
                        show: true,
                        horizAlign: 'insideMax',
                        font: "9pt 'Trebuchet MS'",
                        decimals: 2,
                        useBorder: true,
                        fontcolor: datos[dias[x]] > limite ? 'red' : '#6FB2ED',
                    }});
                ticks.push([x, dias[x]]);
            }
            $.plot($("#msGrafica" + indice), data, {
                series: {
                    bars: {
                        show: true,
                        order: 1,
                        barWidth: 0.6,
                        align: "center",
                    }
                },
                xaxes: [{
                    mode: 'categories',
                    tickLength: 0,
                    axisLabel: 'Semana',
                    ticks: ticks
                }],
                yaxes: [{
                    min: 0,
                    axisLabel: 'Limite',
                }],
                legend: {
                    show: true,
                    placement: 'outsideGrid',
                    container: $('#msLegend' + indice),
                },
                //colors: ["#6FB2ED", "#F9A40F"],
                grid: {
                    color: "#999999",
                    hoverable: true,
                    clickable: true,
                    tickColor: "#D4D4D4",
                    borderWidth: 0,
                    hoverable: true, //IMPORTANT! this is needed for tooltip to work,
                    markings: [
                        { color: '#FF0000', lineWidth: 4, yaxis: { from: limite, to: limite } },
                    ]

                },
                tooltip: true,
                tooltipOpts: {
                    content: function (label, x, y) {
                        return ticks[x][1] + " tiene " + (Math.round(y * 100) / 100).toFixed(1).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " " + datos.Unidad;
                    },
                    defaultTheme: true
                }
            });
        }

        $(document).ready(function () {
            //ObtenerMenus();
            getCurrentWeek('#date1', getApi);
            CargarAreas();
            //cargarGraficaKilomentros();
        });
    </script>



</body>

</html>